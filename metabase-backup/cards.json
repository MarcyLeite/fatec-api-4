[{"description":null,"archived":false,"collection_position":null,"table_id":null,"result_metadata":null,"creator":{"email":"admin@terravision.local","first_name":"Admin","last_login":"2025-05-23T21:17:06.663737Z","is_qbnewb":true,"is_superuser":true,"id":1,"last_name":"Terravision","date_joined":"2025-05-23T21:08:04.533963Z","common_name":"Admin Terravision"},"database_id":2,"enable_embedding":false,"collection_id":null,"query_type":"native","name":"cria tabelas base","creator_id":1,"updated_at":"2025-05-23T21:13:42.295638Z","made_public_by_id":null,"embedding_params":null,"cache_ttl":null,"dataset_query":{"type":"native","database":2,"native":{"query":"create table cidade (\r\n    est_id bigint,\r\n    id bigint generated by default as identity,\r\n    cid_nome varchar(50),\r\n    primary key (id)\r\n);\r\n\r\ncreate table estado (\r\n    id bigint generated by default as identity,\r\n    est_nome varchar(60),\r\n    est_sigla varchar(2),\r\n    primary key (id)\r\n);\r\n\r\ncreate table fazenda (\r\n    faz_area float4,\r\n    faz_prod_anual float4,\r\n    cid_id bigint,\r\n    id bigint generated by default as identity,\r\n    faz_nome varchar(60),\r\n    faz_tipo_solo varchar(100),\r\n    primary key (id)\r\n);\r\n\r\ncreate table relatorio (\r\n    percentual_diff float4,\r\n    rel_status smallint check (rel_status between 0 and 3),\r\n    end_review timestamp(6),\r\n    id bigint generated by default as identity,\r\n    start_review timestamp(6),\r\n    mis_id bigint,\r\n    use_id bigint,\r\n    primary key (id)\r\n);\r\n\r\n\r\ncreate table missao (\r\n    id bigint generated by default as identity,\r\n    primary key (id),\r\n    mis_created_at timestamp(6),\r\n    mis_last_upload timestamp(6),\r\n    mis_status smallint check (mis_status between 0 and 1)\r\n);\r\n\r\ncreate table resultado (\r\n    id bigint generated by default as identity,\r\n    primary key (id),\r\n    res_source smallint check (res_source between 0 and 1),\r\n    mis_id bigint,\r\n    CONSTRAINT unique_mis_id_res_source UNIQUE (mis_id, res_source)\r\n);\r\n\r\ncreate table daninha (\r\n    id bigint generated by default as identity,\r\n    primary key (id),\r\n    dan_geom geometry(Geometry, 4326),\r\n    res_id bigint\r\n);\r\n\r\n\r\ncreate table talhao (\r\n    tal_area float4,\r\n    faz_id bigint,\r\n    id bigint generated by default as identity,\r\n    tal_cultura varchar(60),\r\n    tal_nome varchar(60),\r\n    rel_shape geometry(Geometry, 4326),\r\n    primary key (id)\r\n);\r\n\r\ncreate table usuario (\r\n    use_role smallint check (use_role between 0 and 2),\r\n    created_at timestamp(6),\r\n    id bigint generated by default as identity,\r\n    use_email varchar(100),\r\n    use_nome varchar(60),\r\n    primary key (id)\r\n);\r\n\r\ncreate table mtm_missoes_talhoes (\r\n    tal_id bigint not null,\r\n    mis_id bigint not null,\r\n    primary key (tal_id, mis_id),\r\n    constraint FK_talhao foreign key (tal_id) references talhao(id),\r\n    constraint FK_missao foreign key (mis_id) references missao(id)\r\n);\r\n\r\nalter table if exists cidade \r\n    add constraint FK3jrphg3ll698ta68xi074uesj \r\n    foreign key (est_id) \r\n    references estado;\r\n\r\nalter table if exists fazenda \r\n    add constraint FK1hovweo0237sowrvbo7vxvhkb \r\n    foreign key (cid_id) \r\n    references cidade;\r\n\r\nalter table if exists relatorio \r\n    add constraint FK311ms1ya93wcjxc310qa3bv46 \r\n    foreign key (use_id) \r\n    references usuario;\r\n\r\nalter table if exists relatorio \r\n    add constraint FKg9vmapx1koo03j6n8ew5dj4u3 \r\n    foreign key (mis_id) \r\n    references missao;\r\n\r\nalter table if exists resultado \r\n    add constraint FKg9vmapx1koo03j6n8ew5dj4u3 \r\n    foreign key (mis_id) \r\n    references missao;\r\n\r\nalter table if exists talhao \r\n    add constraint FKnefek7ox53jp06g3bkkhyelkf \r\n    foreign key (faz_id) \r\n    references fazenda;\r\n\r\nalter table if exists daninha\r\n    add constraint FKmissdosijdisojdiajsioajia \r\n    foreign key (res_id) \r\n    references resultado;\r\n\r\n\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Acre', 'AC');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Alagoas', 'AL');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Amapá', 'AP');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Amazonas', 'AM');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Bahia', 'BA');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Ceará', 'CE');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Distrito Federal', 'DF');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Espírito Santo', 'ES');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Goiás', 'GO');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Maranhão', 'MA');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Mato Grosso', 'MT');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Mato Grosso do Sul', 'MS');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Minas Gerais', 'MG');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Pará', 'PA');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Paraíba', 'PB');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Paraná', 'PR');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Pernambuco', 'PE');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Piauí', 'PI');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Rio de Janeiro', 'RJ');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Rio Grande do Norte', 'RN');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Rio Grande do Sul', 'RS');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Rondônia', 'RO');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Roraima', 'RR');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Santa Catarina', 'SC');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('São Paulo', 'SP');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Sergipe', 'SE');\r\nINSERT INTO estado (est_nome, est_sigla) VALUES ('Tocantins', 'TO');\r\n","template-tags":{}}},"id":1,"parameter_mappings":[],"display":"table","entity_id":"I2naxRy3u0aerrlvfctou","collection_preview":true,"last-edit-info":{"id":1,"email":"admin@terravision.local","first_name":"Admin","last_name":"Terravision","timestamp":"2025-05-23T21:13:42.575138Z"},"visualization_settings":{},"collection":null,"metabase_version":"v0.48.4 (62145b0)","parameters":[],"dataset":false,"created_at":"2025-05-23T21:13:42.295638Z","public_uuid":null},{"description":null,"archived":false,"collection_position":null,"table_id":null,"result_metadata":[{"display_name":"media_tempo_analise_minutos","field_ref":["field","media_tempo_analise_minutos",{"base-type":"type/Decimal"}],"name":"media_tempo_analise_minutos","base_type":"type/Decimal","effective_type":"type/Decimal","semantic_type":null,"fingerprint":{"global":{"distinct-count":1,"nil%":1.0},"type":{"type/Number":{"min":null,"q1":null,"q3":null,"max":null,"sd":null,"avg":null}}}}],"creator":{"email":"admin@terravision.local","first_name":"Admin","last_login":"2025-05-23T21:17:06.663737Z","is_qbnewb":true,"is_superuser":true,"id":1,"last_name":"Terravision","date_joined":"2025-05-23T21:08:04.533963Z","common_name":"Admin Terravision"},"database_id":2,"enable_embedding":false,"collection_id":null,"query_type":"native","name":"Média quantia de tempo em QA","creator_id":1,"updated_at":"2025-05-23T21:16:18.513538Z","made_public_by_id":null,"embedding_params":null,"cache_ttl":null,"dataset_query":{"type":"native","database":2,"native":{"query":"SELECT \n    AVG(EXTRACT(EPOCH FROM (r.end_review - r.start_review)) / 60) AS media_tempo_analise_minutos\nFROM \n    relatorio r\nJOIN \n    missao m ON r.mis_id = m.id\nJOIN \n    mtm_missoes_talhoes mt ON m.id = mt.mis_id\nJOIN \n    talhao t ON mt.tal_id = t.id\nJOIN \n    fazenda f ON t.faz_id = f.id\nWHERE \n    r.rel_status = 1\n    [[ AND r.use_id = CAST({{analista_id}} AS bigint) ]]\n    [[ AND r.start_review >= {{data_inicio}} ]]\n    [[ AND r.start_review <= {{data_fim}} ]]\n    [[ AND t.id = CAST({{talhao_id}} AS bigint) ]]\n    [[ AND f.id = CAST({{fazenda_id}} AS bigint) ]]\n;","template-tags":{"analista_id":{"type":"text","name":"analista_id","id":"8f2b5f77-d181-4695-a7c9-5ff04bd6f289","display-name":"Analista ID"},"data_inicio":{"type":"text","name":"data_inicio","id":"851980b3-8a0e-4bce-b3e4-75002b664e58","display-name":"Data Inicio"},"data_fim":{"type":"text","name":"data_fim","id":"8288cc98-1fb8-4cb6-9123-5396b4ff7b5e","display-name":"Data Fim"},"talhao_id":{"type":"text","name":"talhao_id","id":"605cce46-0a4c-4e44-876d-9f9dbc8b0f65","display-name":"Talhao ID"},"fazenda_id":{"type":"text","name":"fazenda_id","id":"4db943f4-b08b-4791-afe4-c08c37b1f9a3","display-name":"Fazenda ID"}}}},"id":4,"parameter_mappings":[],"display":"scalar","entity_id":"P57dcOpvh0V-ibVR1feoz","collection_preview":true,"last-edit-info":{"id":1,"email":"admin@terravision.local","first_name":"Admin","last_name":"Terravision","timestamp":"2025-05-23T21:15:52.499132Z"},"visualization_settings":{},"collection":null,"metabase_version":"v0.48.4 (62145b0)","parameters":[{"id":"8f2b5f77-d181-4695-a7c9-5ff04bd6f289","type":"category","target":["variable",["template-tag","analista_id"]],"name":"Analista ID","slug":"analista_id"},{"id":"851980b3-8a0e-4bce-b3e4-75002b664e58","type":"category","target":["variable",["template-tag","data_inicio"]],"name":"Data Inicio","slug":"data_inicio"},{"id":"8288cc98-1fb8-4cb6-9123-5396b4ff7b5e","type":"category","target":["variable",["template-tag","data_fim"]],"name":"Data Fim","slug":"data_fim"},{"id":"605cce46-0a4c-4e44-876d-9f9dbc8b0f65","type":"category","target":["variable",["template-tag","talhao_id"]],"name":"Talhao ID","slug":"talhao_id"},{"id":"4db943f4-b08b-4791-afe4-c08c37b1f9a3","type":"category","target":["variable",["template-tag","fazenda_id"]],"name":"Fazenda ID","slug":"fazenda_id"}],"dataset":false,"created_at":"2025-05-23T21:15:52.467696Z","public_uuid":null},{"description":null,"archived":false,"collection_position":null,"table_id":null,"result_metadata":[{"display_name":"status","field_ref":["field","status",{"base-type":"type/Text"}],"name":"status","base_type":"type/Text","effective_type":"type/Text","semantic_type":"type/Category","fingerprint":{"global":{"distinct-count":0,"nil%":null},"type":{"type/Text":{"percent-json":null,"percent-url":null,"percent-email":null,"percent-state":null,"average-length":null}}}},{"display_name":"quantidade","field_ref":["field","quantidade",{"base-type":"type/BigInteger"}],"name":"quantidade","base_type":"type/BigInteger","effective_type":"type/BigInteger","semantic_type":null,"fingerprint":{"global":{"distinct-count":0,"nil%":null},"type":{"type/Number":{"min":null,"q1":null,"q3":null,"max":null,"sd":null,"avg":null}}}}],"creator":{"email":"admin@terravision.local","first_name":"Admin","last_login":"2025-05-23T21:17:06.663737Z","is_qbnewb":true,"is_superuser":true,"id":1,"last_name":"Terravision","date_joined":"2025-05-23T21:08:04.533963Z","common_name":"Admin Terravision"},"database_id":2,"enable_embedding":false,"collection_id":null,"query_type":"native","name":"quantia de algo nao tenho certeza","creator_id":1,"updated_at":"2025-05-23T21:16:22.370014Z","made_public_by_id":null,"embedding_params":null,"cache_ttl":null,"dataset_query":{"type":"native","database":2,"native":{"query":"SELECT \n    status,\n    COUNT(*) AS quantidade\nFROM (\n    SELECT DISTINCT  -- Remove duplicatas antes de contar\n        r.id,\n        r.rel_status,\n        CASE \n            WHEN r.rel_status = 0 THEN 'Pending'\n            WHEN r.rel_status = 1 THEN 'Approved'\n            WHEN r.rel_status = 2 THEN 'Reproved'\n            WHEN r.rel_status = 3 THEN 'Edited'\n        END AS status\n    FROM \n        relatorio r\n    JOIN \n        missao m ON r.mis_id = m.id\n    JOIN \n        mtm_missoes_talhoes mt ON m.id = mt.mis_id\n    JOIN \n        talhao t ON mt.tal_id = t.id\n    JOIN \n        fazenda f ON t.faz_id = f.id\n    WHERE \n        1=1\n    [[ AND r.use_id = CAST({{analista_id}} AS bigint) ]]\n    [[ AND r.start_review >= {{data_inicio}} ]]\n    [[ AND r.start_review <= {{data_fim}} ]]\n    [[ AND t.id = CAST({{talhao_id}} AS bigint) ]]\n    [[ AND f.id = CAST({{fazenda_id}} AS bigint) ]]\n) AS relatorios_unicos\nGROUP BY \n    status, rel_status\nORDER BY \n    rel_status","template-tags":{"analista_id":{"type":"text","name":"analista_id","id":"70174773-a1af-4f04-8e2e-baa25f543d14","display-name":"Analista ID"},"data_inicio":{"type":"text","name":"data_inicio","id":"870f9c7b-5a6b-46f1-a22e-4e31eb238b48","display-name":"Data Inicio"},"data_fim":{"type":"text","name":"data_fim","id":"9f4afbec-4342-45f0-bbdd-0d37be367f0c","display-name":"Data Fim"},"talhao_id":{"type":"text","name":"talhao_id","id":"f335dac7-727f-498e-a2e9-2a949b540d89","display-name":"Talhao ID"},"fazenda_id":{"type":"text","name":"fazenda_id","id":"a0cf3032-765f-4d8a-bfe3-cdac5a92757e","display-name":"Fazenda ID"}}}},"id":3,"parameter_mappings":[],"display":"table","entity_id":"YZRxUBuatGGW91rbNkwIl","collection_preview":true,"last-edit-info":{"id":1,"email":"admin@terravision.local","first_name":"Admin","last_name":"Terravision","timestamp":"2025-05-23T21:15:11.763845Z"},"visualization_settings":{"table.pivot_column":"status","table.cell_column":"quantidade"},"collection":null,"metabase_version":"v0.48.4 (62145b0)","parameters":[{"id":"70174773-a1af-4f04-8e2e-baa25f543d14","type":"category","target":["variable",["template-tag","analista_id"]],"name":"Analista ID","slug":"analista_id"},{"id":"870f9c7b-5a6b-46f1-a22e-4e31eb238b48","type":"category","target":["variable",["template-tag","data_inicio"]],"name":"Data Inicio","slug":"data_inicio"},{"id":"9f4afbec-4342-45f0-bbdd-0d37be367f0c","type":"category","target":["variable",["template-tag","data_fim"]],"name":"Data Fim","slug":"data_fim"},{"id":"f335dac7-727f-498e-a2e9-2a949b540d89","type":"category","target":["variable",["template-tag","talhao_id"]],"name":"Talhao ID","slug":"talhao_id"},{"id":"a0cf3032-765f-4d8a-bfe3-cdac5a92757e","type":"category","target":["variable",["template-tag","fazenda_id"]],"name":"Fazenda ID","slug":"fazenda_id"}],"dataset":false,"created_at":"2025-05-23T21:15:11.717111Z","public_uuid":null},{"description":null,"archived":false,"collection_position":null,"table_id":null,"result_metadata":[{"display_name":"missoes_pendentes","field_ref":["field","missoes_pendentes",{"base-type":"type/BigInteger"}],"name":"missoes_pendentes","base_type":"type/BigInteger","effective_type":"type/BigInteger","semantic_type":null,"fingerprint":{"global":{"distinct-count":1,"nil%":0.0},"type":{"type/Number":{"min":0.0,"q1":0.0,"q3":0.0,"max":0.0,"sd":null,"avg":0.0}}}},{"display_name":"missoes_finalizadas","field_ref":["field","missoes_finalizadas",{"base-type":"type/BigInteger"}],"name":"missoes_finalizadas","base_type":"type/BigInteger","effective_type":"type/BigInteger","semantic_type":null,"fingerprint":{"global":{"distinct-count":1,"nil%":0.0},"type":{"type/Number":{"min":0.0,"q1":0.0,"q3":0.0,"max":0.0,"sd":null,"avg":0.0}}}},{"display_name":"total_missoes","field_ref":["field","total_missoes",{"base-type":"type/BigInteger"}],"name":"total_missoes","base_type":"type/BigInteger","effective_type":"type/BigInteger","semantic_type":null,"fingerprint":{"global":{"distinct-count":1,"nil%":0.0},"type":{"type/Number":{"min":0.0,"q1":0.0,"q3":0.0,"max":0.0,"sd":null,"avg":0.0}}}}],"creator":{"email":"admin@terravision.local","first_name":"Admin","last_login":"2025-05-23T21:17:06.663737Z","is_qbnewb":true,"is_superuser":true,"id":1,"last_name":"Terravision","date_joined":"2025-05-23T21:08:04.533963Z","common_name":"Admin Terravision"},"database_id":2,"enable_embedding":false,"collection_id":null,"query_type":"native","name":"Total de missoes","creator_id":1,"updated_at":"2025-05-23T21:16:23.208582Z","made_public_by_id":null,"embedding_params":null,"cache_ttl":null,"dataset_query":{"type":"native","database":2,"native":{"query":"SELECT \n    COUNT(*) FILTER (WHERE m.mis_status = 0) AS missoes_pendentes,\n    COUNT(*) FILTER (WHERE m.mis_status = 1) AS missoes_finalizadas,\n    COUNT(*) AS total_missoes\nFROM \n    missao m\nJOIN \n    mtm_missoes_talhoes mt ON m.id = mt.mis_id\nJOIN \n    talhao t ON mt.tal_id = t.id\nJOIN \n    fazenda f ON t.faz_id = f.id\nWHERE \n    1=1\n    [[ AND r.use_id = {{analista_id}} ]]\n    [[ AND r.start_review >= {{data_inicio}} ]]\n    [[ AND r.start_review <= {{data_fim}} ]]\n    [[ AND t.id = {{talhao_id}} ]]\n    [[ AND f.id = {{fazenda_id}} ]]\n;","template-tags":{"analista_id":{"type":"text","name":"analista_id","id":"f6e65803-242e-4e92-be29-0ee250230e64","display-name":"Analista ID"},"data_inicio":{"type":"text","name":"data_inicio","id":"3836e563-6c1c-4496-9f51-50a37ca09161","display-name":"Data Inicio"},"data_fim":{"type":"text","name":"data_fim","id":"4932a981-007e-42e8-aafe-8b27f43fefdd","display-name":"Data Fim"},"talhao_id":{"type":"text","name":"talhao_id","id":"158c3dc7-a80b-491b-928f-e1862c7cd4c7","display-name":"Talhao ID"},"fazenda_id":{"type":"text","name":"fazenda_id","id":"a92b4706-fdcc-44f3-8490-051183b2f949","display-name":"Fazenda ID"}}}},"id":2,"parameter_mappings":[],"display":"table","entity_id":"13D99I4z0zDxA-S-YU6c-","collection_preview":true,"last-edit-info":{"id":1,"email":"admin@terravision.local","first_name":"Admin","last_name":"Terravision","timestamp":"2025-05-23T21:14:29.902284Z"},"visualization_settings":{"table.pivot_column":"missoes_pendentes","table.cell_column":"missoes_finalizadas"},"collection":null,"metabase_version":"v0.48.4 (62145b0)","parameters":[{"id":"f6e65803-242e-4e92-be29-0ee250230e64","type":"category","target":["variable",["template-tag","analista_id"]],"name":"Analista ID","slug":"analista_id"},{"id":"3836e563-6c1c-4496-9f51-50a37ca09161","type":"category","target":["variable",["template-tag","data_inicio"]],"name":"Data Inicio","slug":"data_inicio"},{"id":"4932a981-007e-42e8-aafe-8b27f43fefdd","type":"category","target":["variable",["template-tag","data_fim"]],"name":"Data Fim","slug":"data_fim"},{"id":"158c3dc7-a80b-491b-928f-e1862c7cd4c7","type":"category","target":["variable",["template-tag","talhao_id"]],"name":"Talhao ID","slug":"talhao_id"},{"id":"a92b4706-fdcc-44f3-8490-051183b2f949","type":"category","target":["variable",["template-tag","fazenda_id"]],"name":"Fazenda ID","slug":"fazenda_id"}],"dataset":false,"created_at":"2025-05-23T21:14:29.866565Z","public_uuid":null}]